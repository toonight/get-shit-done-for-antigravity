# Architecture

> Auto-generated by /map on 2026-01-17

## Overview

GSD for Antigravity is a **meta-prompting system** for spec-driven, context-engineered development. It translates the GSD methodology into Google Antigravity's native workflow and skill systems.

```
┌─────────────────────────────────────────────────────────────────┐
│                          USER                                   │
│                    (slash commands)                             │
└────────────────────────┬────────────────────────────────────────┘
                         │
                         ▼
┌─────────────────────────────────────────────────────────────────┐
│                     WORKFLOWS (.agent/workflows/)               │
│  /map → /plan → /execute → /verify → /debug                    │
│  /progress, /pause, /resume                                     │
└────────────────────────┬────────────────────────────────────────┘
                         │ (reference)
                         ▼
┌─────────────────────────────────────────────────────────────────┐
│                      SKILLS (.agent/skills/)                    │
│  planner, executor, verifier, debugger                          │
│  codebase-mapper, plan-checker                                  │
│  context-health-monitor, empirical-validation                   │
└────────────────────────┬────────────────────────────────────────┘
                         │ (read/write)
                         ▼
┌─────────────────────────────────────────────────────────────────┐
│                   DOCUMENTATION (.gsd/)                         │
│  SPEC.md, ROADMAP.md, STATE.md                                 │
│  ARCHITECTURE.md, STACK.md, DECISIONS.md, JOURNAL.md           │
│  templates/, phases/                                            │
└────────────────────────┬────────────────────────────────────────┘
                         │ (enforced by)
                         ▼
┌─────────────────────────────────────────────────────────────────┐
│                   RULES (.gemini/GEMINI.md)                     │
│  Planning Lock, State Persistence, Context Hygiene             │
│  Empirical Validation                                           │
└─────────────────────────────────────────────────────────────────┘
```

## Components

### Workflows (`/.agent/workflows/`)
- **Purpose:** Define slash command behaviors
- **Location:** `.agent/workflows/*.md`
- **Files:** 8 workflow definitions
- **Pattern:** YAML frontmatter + XML-structured process

| Workflow | Purpose | Priority |
|----------|---------|----------|
| map.md | Analyze codebase | Setup |
| plan.md | Create execution plans | Planning |
| execute.md | Implement plans | Execution |
| verify.md | Validate work | Verification |
| debug.md | Systematic debugging | Support |
| progress.md | Show status | Navigation |
| pause.md | Session handoff | State |
| resume.md | Session restore | State |

### Skills (`/.agent/skills/`)
- **Purpose:** Specialized agent behaviors
- **Location:** `.agent/skills/{name}/SKILL.md`
- **Files:** 8 skill definitions
- **Pattern:** YAML frontmatter + detailed instructions

| Skill | Purpose |
|-------|---------|
| planner | Task anatomy, goal-backward methodology |
| executor | Atomic commits, Need-to-Know context |
| verifier | Must-haves, evidence requirements |
| debugger | 3-strike rule, systematic diagnosis |
| codebase-mapper | Structure analysis |
| plan-checker | Plan validation |
| context-health-monitor | Prevents context rot |
| empirical-validation | Requires proof |

### Documentation (`/.gsd/`)
- **Purpose:** Project state and planning
- **Location:** `.gsd/*.md`
- **Files:** 7 base documents + 4 templates

| Document | Purpose | Updated By |
|----------|---------|------------|
| SPEC.md | Vision & goals | User |
| ROADMAP.md | Phase definitions | /plan |
| STATE.md | Session memory | All workflows |
| ARCHITECTURE.md | System design | /map |
| STACK.md | Tech inventory | /map |
| DECISIONS.md | ADR log | /plan, /debug |
| JOURNAL.md | Session log | /pause, /verify |

### Rules (`/.gemini/GEMINI.md`)
- **Purpose:** Enforce GSD methodology
- **Location:** `.gemini/GEMINI.md`
- **Rules:** 4 core constraints

| Rule | Enforcement |
|------|-------------|
| Planning Lock | No code until SPEC finalized |
| State Persistence | Update STATE.md after tasks |
| Context Hygiene | 3 failures → state dump |
| Empirical Validation | Proof required |

## Data Flow

1. **User invokes workflow** (e.g., `/plan 1`)
2. **Workflow loads context** from `.gsd/` files
3. **Workflow references skills** for specialized behavior
4. **Workflow updates state** in `.gsd/STATE.md`
5. **Rules enforce constraints** via GEMINI.md

## Technical Debt

### Resolved ✅
- [x] ~~No automated tests for workflow logic~~ → `validate-all.ps1/.sh` (v1.3)
- [x] ~~Templates are examples, not validated schemas~~ → `validate-templates.ps1/.sh` (v1.4)
- [x] ~~No version tracking for workflow changes~~ → `VERSION` file (v1.3)
- [x] ~~Missing `/add-todo`, `/check-todos` workflows~~ → Added (v1.1)

### Remaining
- [ ] No CI/CD for automated validation on push
- [ ] Skills lack unit test coverage

## Conventions

**Naming:** 
- Workflows: `{verb}.md` (e.g., `plan.md`, `verify.md`)
- Skills: `{noun}/SKILL.md` (e.g., `planner/SKILL.md`)
- Docs: `{NOUN}.md` (uppercase, e.g., `SPEC.md`)

**Structure:**
- All files are Markdown
- Workflows use XML tags for semantic structure
- Frontmatter (YAML) for metadata

---

*Last updated: 2026-01-17*
